OpenLayers.Layer.NAMRIA=OpenLayers.Class(OpenLayers.Layer.XYZ,{forceMapSettings:!0,url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(a,b,c){if(c.tileOrigin=new OpenLayers.LonLat(-20037508.342787,20037508.342787),c.projection="EPSG:900913",c.resolutions=[3968.75793751588,2645.83862501058,1322.91931250529,661.459656252646,264.583862501058,132.291931250529,66.1459656252646,26.4583862501058,13.2291931250529,6.61459656252646,2.64583862501058,1.32291931250529,.661459656252646],OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.forceMapSettings&&this.events.register("added",this,function(a){a.map.restrictedExtent=new OpenLayers.Bounds(11516520.903064,482870.29798867,15821300.345956,2448728.3963715),a.projection="EPSG:900913"}),this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0])),this.layerInfo){var d=this.layerInfo,e=new OpenLayers.Bounds(d.fullExtent.xmin,d.fullExtent.ymin,d.fullExtent.xmax,d.fullExtent.ymax);if(this.projection="EPSG:"+d.spatialReference.wkid,this.sphericalMercator=102100==d.spatialReference.wkid,this.units="esriFeet"==d.units?"ft":"m",d.tileInfo){this.tileSize=new OpenLayers.Size(d.tileInfo.width||d.tileInfo.cols,d.tileInfo.height||d.tileInfo.rows),this.tileOrigin=new OpenLayers.LonLat(d.tileInfo.origin.x,d.tileInfo.origin.y);var f=new OpenLayers.Geometry.Point(e.left,e.top),g=new OpenLayers.Geometry.Point(e.right,e.bottom);this.useScales?this.scales=[]:this.resolutions=[],this.lods=[];for(var h in d.tileInfo.lods)if(d.tileInfo.lods.hasOwnProperty(h)){var i=d.tileInfo.lods[h];this.useScales?this.scales.push(i.scale):this.resolutions.push(i.resolution);var j=this.getContainingTileCoords(f,i.resolution);i.startTileCol=j.x,i.startTileRow=j.y;var k=this.getContainingTileCoords(g,i.resolution);i.endTileCol=k.x,i.endTileRow=k.y,this.lods.push(i)}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]),this.serverResolutions=this.resolutions,this.overrideDPI&&d.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=d.tileInfo.dpi)}}},getContainingTileCoords:function(a,b){return new OpenLayers.Pixel(Math.max(Math.floor((a.x-this.tileOrigin.lon)/(this.tileSize.w*b)),0),Math.max(Math.floor((this.tileOrigin.lat-a.y)/(this.tileSize.h*b)),0))},calculateMaxExtentWithLOD:function(a){var b=a.endTileCol-a.startTileCol+1,c=a.endTileRow-a.startTileRow+1,d=this.tileOrigin.lon+a.startTileCol*this.tileSize.w*a.resolution,e=d+b*this.tileSize.w*a.resolution,f=this.tileOrigin.lat-a.startTileRow*this.tileSize.h*a.resolution,g=f-c*this.tileSize.h*a.resolution;return new OpenLayers.Bounds(d,g,e,f)},calculateMaxExtentWithExtent:function(a,b){var c=new OpenLayers.Geometry.Point(a.left,a.top),d=new OpenLayers.Geometry.Point(a.right,a.bottom),e=this.getContainingTileCoords(c,b),f=this.getContainingTileCoords(d,b),g={resolution:b,startTileCol:e.x,startTileRow:e.y,endTileCol:f.x,endTileRow:f.y};return this.calculateMaxExtentWithLOD(g)},getUpperLeftTileCoord:function(a){var b=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(b,a)},getLowerRightTileCoord:function(a){var b=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(b,a)},getMaxExtentForResolution:function(a){var b=this.getUpperLeftTileCoord(a),c=this.getLowerRightTileCoord(a),d=c.x-b.x+1,e=c.y-b.y+1,f=this.tileOrigin.lon+b.x*this.tileSize.w*a,g=f+d*this.tileSize.w*a,h=this.tileOrigin.lat-b.y*this.tileSize.h*a,i=h-e*this.tileSize.h*a;return new OpenLayers.Bounds(f,i,g,h)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.NAMRIA(this.name,this.url,this.options)),OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},initGriddedTiles:function(){delete this._tileOrigin,OpenLayers.Layer.XYZ.prototype.initGriddedTiles.apply(this,arguments)},getMaxExtent:function(){var a=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(a)},getTileOrigin:function(){if(!this._tileOrigin){var a=this.getMaxExtent();this._tileOrigin=new OpenLayers.LonLat(a.left,a.bottom)}return this._tileOrigin},getURL:function(a){var b=this.getResolution(),c=this.tileOrigin.lon+b*this.tileSize.w/2,d=this.tileOrigin.lat-b*this.tileSize.h/2,e=a.getCenterLonLat();({x:e.lon,y:e.lat});var g=Math.round(Math.abs((e.lon-c)/(b*this.tileSize.w))),h=Math.round(Math.abs((d-e.lat)/(b*this.tileSize.h))),i=this.map.getZoom();if(this.lods){var j=this.lods[this.map.getZoom()];if(g<j.startTileCol||g>j.endTileCol||h<j.startTileRow||h>j.endTileRow)return null}else{var k=this.getUpperLeftTileCoord(b),l=this.getLowerRightTileCoord(b);if(g<k.x||g>=l.x||h<k.y||h>=l.y)return null}var m=this.url,n=""+g+h+i;return OpenLayers.Util.isArray(m)&&(m=this.selectUrl(n,m)),this.useArcGISServer?m+="/tile/${z}/${y}/${x}":(g="C"+OpenLayers.Number.zeroPad(g,8,16),h="R"+OpenLayers.Number.zeroPad(h,8,16),i="L"+OpenLayers.Number.zeroPad(i,2,10),m=m+"/${z}/${y}/${x}."+this.type),m=OpenLayers.String.format(m,{x:g,y:h,z:i}),OpenLayers.Util.urlAppend(m,OpenLayers.Util.getParameterString(this.params))},CLASS_NAME:"OpenLayers.Layer.NAMRIA"});